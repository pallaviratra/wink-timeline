var readModel = require( './read-core-model.js' );

var loadModel = function () {
  var model = readModel( require.resolve( './languages/cur/models/eng-core-model.bin' ) );
  // Capture intrinsic size of chosen features i.e. the ones that have
  // `model.packing.layout[ f ][ 3 ]` set to `0`. Also initialize their
  // index, required for new value addition. The access methods differ
  // if indexes > intrinsic size of a feature.
  // ALSO build the efList here itself.
  model.packing.efList = [];
  for ( const f in model.packing.layout ) { // eslint-disable-line guard-for-in
    // Capture intrinsic size.
    if ( model.packing.layout[ f ][ 3 ] === 0 ) {
      model.features[ f ].intrinsicSize = model.features[ f ].list.length;
      model.features[ f ].index = model.features[ f ].list.length;
      model.features[ f ].maxIndex = ( model.packing.layout[ f ][ 1 ] >>> model.packing.layout[ f ][ 2 ] ); // eslint-disable-line no-bitwise
    }
    // Build the efList.
    if ( model.packing.layout[ f ][ 4 ] === 1 ) {
      model.packing.efList.push( f );
    }
  }
  // Finally the `lexeme` as it is not really counted as a feature.
  model.features.lexeme.intrinsicSize = model.features.lexeme.list.length;
  model.features.lexeme.index = model.features.lexeme.list.length;

  return model;
};

module.exports = loadModel;
